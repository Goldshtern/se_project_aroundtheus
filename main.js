!function(){"use strict";class e{constructor(e,t,s,r,i){let{name:n,link:o,_id:a,isLiked:l}=e;this._data={name:n,link:o,_id:a},this._name=n,this._link=o,this.id=a,this._cardSelector=t,this._handleImageClick=s,this._handleDeleteCard=r,this.isLiked=l,this._handleLikeIcon=i}getLikedStatus(){return this.isLiked}setIsLiked(e){this.isLiked=e,this._renderLikes()}_renderLikes(){this.isLiked?this._likeBtn.classList.add("card__like-button_active"):this._likeBtn.classList.remove("card__like-button_active")}_setEventListeners(){this._likeBtn.addEventListener("click",(()=>{this._handleLikeIcon(this)})),this._deleteBtn.addEventListener("click",(()=>{this._handleDeleteCard(this)})),this._cardImageEl.addEventListener("click",(()=>{this._handleImageClick({name:this._name,link:this._link})}))}getView(){return this._cardElement=document.querySelector(this._cardSelector).content.querySelector(".card").cloneNode(!0),this._likeBtn=this._cardElement.querySelector(".card__like-button"),this._deleteBtn=this._cardElement.querySelector(".card__delete-button"),this._cardImageEl=this._cardElement.querySelector(".card__image"),this._cardTitleEl=this._cardElement.querySelector(".card__title"),this._cardImageEl.src=this._link,this._cardImageEl.alt=this._data.name+" Image",this._cardTitleEl.textContent=this._data.name,this._setEventListeners(),this._renderLikes(),this._cardElement}removeCardElement(){this._cardElement.remove(),this._cardElement=null}}class t{constructor(e,t){this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._form=t}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._inputErrorClass),t.textContent=e.validationMessage,t.classList.add(this._errorClass)}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._inputErrorClass),t.textContent="",t.classList.remove(this._errorClass)}_checkInputValidity(e){if(!e.validity.valid)return this._showInputError(e);this._hideInputError(e)}_hasInvalidInput(e){return!e.every((e=>e.validity.valid))}disableButton(){this._submitButton.classList.add(this._inactiveButtonClass),this._submitButton.disabled=!0}_enableButton(){this._submitButton.classList.remove(this._inactiveButtonClass),this._submitButton.disabled=!1}_toggleButtonState(){this._hasInvalidInput(this._inputEls)?this.disableButton():this._enableButton()}_setEventListeners(){this._inputEls=[...this._form.querySelectorAll(this._inputSelector)],this._submitButton=this._form.querySelector(this._submitButtonSelector),this._inputEls.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState()}))}))}enableValidation(){this._form.addEventListener("submit",(e=>{e.preventDefault(e)})),this._setEventListeners()}resetValidation(){this._toggleButtonState(),this._inputEls.forEach((e=>{this._hideInputError(e)}))}}class s{constructor(e,t){let{items:s,renderer:r}=e;this._items=s,this._renderer=r,this._container=document.querySelector(t)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}addItem(e){this._container.prepend(e)}}class r{constructor(e){let{popupSelector:t}=e;this._popupElement=document.querySelector(t),this._handleEscClose=this._handleEscClose.bind(this)}open(){this._popupElement.classList.add("modal_opened"),document.addEventListener("keydown",this._handleEscClose)}close(){this._popupElement.classList.remove("modal_opened"),document.removeEventListener("keydown",this._handleEscClose)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popupCloseBtn=this._popupElement.querySelector(".modal__close-button"),this._popupCloseBtn.addEventListener("click",(()=>{this.close()})),this._popupElement.addEventListener("click",(e=>{e.target===e.currentTarget&&this.close()}))}}class i extends r{constructor(e,t){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form"),this._handleFormSubmit=t,this._submitButton=this._popupElement.querySelector(".modal__button")}viewLoading(e){this._submitButton.textContent=e?"Saving...":"Save"}_getInputValues(){this._inputElements=Array.from(this._popupForm.querySelectorAll(".modal__field"));const e={};return this._inputElements.forEach((t=>{e[t.name]=t.value})),e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit(this._getInputValues())}))}resetForm(){this._popupForm.reset()}}const n={formSelector:".modal__form",inputSelector:".modal__field",submitButtonSelector:".modal__button",inactiveButtonClass:"modal__button_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error_visible"},o=document.forms["add-profile-form"],a=document.forms["add-card-form"],l=document.forms["add-avatar-form"],c=document.querySelector("#profile-edit-button"),d=document.querySelector("#profile-add-button"),h=document.querySelector("#avatar-edit-button"),u=(document.querySelector(".gallery__cards"),document.querySelector("#modal-image")),_=(u.querySelector(".modal__image"),u.querySelector(".modal__image-title"),document.querySelector("#profile-edit-modal"),document.querySelector(".profile__title"),document.querySelector(".profile__description"),document.querySelector("#profile-title-input")),m=document.querySelector("#profile-description-input");document.querySelector("#profile-modal-close-button"),document.querySelector("#card-template").content.firstElementChild,document.querySelector("#card-edit-modal"),document.querySelector("#card-modal-close-button"),document.querySelector("#card-title-input"),document.querySelector("#image-URL-input"),document.querySelector("#image-modal-close-button");const p=new class{constructor(e){let{baseUrl:t,headers:s}=e;this._baseUrl=t,this._headers=s}getUserInfoAndCards(){return Promise.all([this.getInitialCards(),this.getUser()])}_checkResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getInitialCards(){return fetch(`${this._baseUrl}/cards`,{headers:this._headers}).then(this._checkResponse).catch((e=>{console.error(e)}))}getUser(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._checkResponse).catch((e=>{console.error(e)}))}addCard(e){let{name:t,link:s}=e;return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:t,link:s})}).then(this._checkResponse).catch((e=>{console.error(e)}))}editProfile(e,t){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(this._checkResponse).catch((e=>{console.error(e)}))}removeCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"DELETE",headers:this._headers}).then(this._checkResponse).catch((e=>{console.error(e)}))}addLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes/`,{method:"PUT",headers:this._headers,body:JSON.stringify({isLiked:!0})}).then(this._checkResponse).catch((e=>{console.error(e)}))}removeLike(e){return fetch(`${this._baseUrl}/cards/${e}/likes/`,{method:"DELETE",headers:this._headers,body:JSON.stringify({isLiked:!1})}).then(this._checkResponse).catch((e=>{console.error(e)}))}updateAvatar(e){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._checkResponse).catch((e=>{console.error(e)}))}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"096eb059-8249-432c-aed5-ea6f0d18c1d5","Content-Type":"application/json"}}),E=new class{constructor(e,t,s){this._name=document.querySelector(e),this._about=document.querySelector(t),this._avatar=document.querySelector(s)}getUserInfo(){return{name:this._name.textContent,about:this._about.textContent}}setUserInfo(e,t){this._name.textContent=e,this._about.textContent=t}setAvatar(e){this._avatar.src=e}}(".profile__title",".profile__description",".profile__image");let v;function f(e){y.open(e)}function b(t){return new e(t,"#card-template",f,B,I).getView()}p.getInitialCards().then((e=>{v=new s({items:e,renderer:e=>{const t=b(e);v.addItem(t)}},".gallery__cards"),v.renderItems()})).catch((e=>console.error(e))),p.getUser().then((e=>{E.setUserInfo(e.name,e.about)})),d.addEventListener("click",(()=>{g.open()})),c.addEventListener("click",(()=>{const e=E.getUserInfo();_.value=e.name,m.value=e.about,C.open()}));const S=new t(n,o),L=new t(n,a),k=new t(n,l);S.enableValidation(),L.enableValidation(),k.enableValidation();const y=new class extends r{constructor(e){super({popupSelector:e}),this._previewImageElement=this._popupElement.querySelector(".modal__image"),this._previewImageElementTitle=this._popupElement.querySelector(".modal__image-title")}open(e){this._previewImageElement.setAttribute("src",e.link),this._previewImageElement.setAttribute("alt",e.name+" Image"),this._previewImageElementTitle.textContent=e.name,super.open()}}("#modal-image");y.setEventListeners();const g=new i("#card-edit-modal",(function(e){g.viewLoading(!0),p.addCard(e).then((e=>{v.addItem(b({name:e.name,link:e.link})),L.disableButton(),g.resetForm(),g.close()})).catch((e=>{console.err(e)})).finally((()=>{g.viewLoading(!1)}))}));g.setEventListeners();const C=new i("#profile-edit-modal",(function(e){C.viewLoading(!0),p.editProfile(e.name,e.about).then((e=>{E.setUserInfo(e),S.disableButton(),C.close()})).catch((e=>{console.err(e)})).finally((()=>{w.viewLoading(!1)}))}));function I(e){e.isLiked?p.removeLike(e.id).then((()=>{e.setIsLiked(!1)})).catch((e=>console.error(e))):p.addLike(e.id).then((()=>{e.setIsLiked(!0)})).catch((e=>console.error(e)))}C.setEventListeners();const q=new class extends r{constructor(e){super({popupSelector:e}),this._popupForm=this._popupElement.querySelector(".modal__form")}setConfirmDelete(e){this._handleFormSubmit=e}setEventListeners(){super.setEventListeners(),this._popupForm.addEventListener("submit",(e=>{e.preventDefault(),this._handleFormSubmit()}))}}("#modal-delete-card");function B(e){q.open(),q.setConfirmDelete((()=>{p.removeCard(e.id).then((()=>{e.removeCardElement(),q.close()})).catch((e=>{console.error(e)}))}))}q.setEventListeners(),h.addEventListener("click",(()=>{w.open()}));const w=new i("#modal-update-avatar",(function(e){let{link:t}=e;w.viewLoading(!0),p.updateAvatar(t).then((()=>{E.setAvatar(t),w.close()})).catch((e=>{console.error(e)})).finally((()=>{w.viewLoading(!1)}))}));w.setEventListeners()}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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RTVCLEdKeUo2QyxzQkFHL0MsU0FBU3RHLEVBQWlCeUwsR0FDeEJDLEVBQWdCaEcsT0FDaEJnRyxFQUFnQkMsa0JBQWlCLEtBQy9CN0QsRUFDRzhCLFdBQVc2QixFQUFLL0ssSUFDaEJxSSxNQUFLLEtBQ0owQyxFQUFLckosb0JBQ0xzSixFQUFnQi9GLE9BQU8sSUFFeEJxRCxPQUFPQyxJQUNOQyxRQUFRQyxNQUFNRixFQUFJLEdBQ2xCLEdBRVIsQ0FmQXlDLEVBQWdCNUYsb0JBaUJoQjJCLEVBQW9CbEcsaUJBQWlCLFNBQVMsS0FDNUNpSyxFQUFnQjlGLE1BQU0sSUFHeEIsTUFBTThGLEVBQWtCLElBQUl0RixFQUMxQix3QkFLRixTQUEyQnJHLEdBQVcsSUFBVixLQUFFTSxHQUFNTixFQUNsQzJMLEVBQWdCakYsYUFBWSxHQUM1QnVCLEVBQ0drQyxhQUFhN0osR0FDYjRJLE1BQUssS0FDSm9CLEVBQVNLLFVBQVVySyxHQUNuQnFMLEVBQWdCN0YsT0FBTyxJQUV4QnFELE9BQU9DLElBQ05DLFFBQVFDLE1BQU1GLEVBQUksSUFFbkJzQyxTQUFRLEtBQ1BDLEVBQWdCakYsYUFBWSxFQUFNLEdBRXhDLElBaEJBaUYsRUFBZ0IxRixtQiIsInNvdXJjZXMiOlsid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL0NhcmQuanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvRm9ybVZhbGlkYXRvci5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvY29tcG9uZW50cy9TZWN0aW9uLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL3V0aWxzL2NvbnN0YW50cy5qcyIsIndlYnBhY2s6Ly9wcmFjdGljdW0vLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vcHJhY3RpY3VtLy4vc3JjL2NvbXBvbmVudHMvQXBpLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1VzZXJJbmZvLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL1BvcHVwV2l0aEltYWdlLmpzIiwid2VicGFjazovL3ByYWN0aWN1bS8uL3NyYy9jb21wb25lbnRzL3BvcHVwQ29uZmlybURlbGV0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJleHBvcnQgZGVmYXVsdCBjbGFzcyBDYXJkIHtcbiAgY29uc3RydWN0b3IoXG4gICAgeyBuYW1lLCBsaW5rLCBfaWQsIGlzTGlrZWQgfSxcbiAgICBjYXJkU2VsZWN0b3IsXG4gICAgaGFuZGxlSW1hZ2VDbGljayxcbiAgICBoYW5kbGVEZWxldGVDYXJkLFxuICAgIGhhbmRsZUxpa2VJY29uXG4gICkge1xuICAgIHRoaXMuX2RhdGEgPSB7IG5hbWUsIGxpbmssIF9pZCB9O1xuICAgIHRoaXMuX25hbWUgPSBuYW1lO1xuICAgIHRoaXMuX2xpbmsgPSBsaW5rO1xuICAgIHRoaXMuaWQgPSBfaWQ7XG4gICAgdGhpcy5fY2FyZFNlbGVjdG9yID0gY2FyZFNlbGVjdG9yO1xuICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2sgPSBoYW5kbGVJbWFnZUNsaWNrO1xuICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQgPSBoYW5kbGVEZWxldGVDYXJkO1xuICAgIHRoaXMuaXNMaWtlZCA9IGlzTGlrZWQ7XG4gICAgdGhpcy5faGFuZGxlTGlrZUljb24gPSBoYW5kbGVMaWtlSWNvbjtcbiAgfVxuXG4gIGdldExpa2VkU3RhdHVzKCkge1xuICAgIHJldHVybiB0aGlzLmlzTGlrZWQ7XG4gIH1cblxuICBzZXRJc0xpa2VkKGlzTGlrZWQpIHtcbiAgICB0aGlzLmlzTGlrZWQgPSBpc0xpa2VkO1xuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XG4gIH1cblxuICBfcmVuZGVyTGlrZXMoKSB7XG4gICAgaWYgKHRoaXMuaXNMaWtlZCkge1xuICAgICAgdGhpcy5fbGlrZUJ0bi5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idXR0b25fYWN0aXZlXCIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9saWtlQnRuLmNsYXNzTGlzdC5yZW1vdmUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIik7XG4gICAgfVxuICB9XG5cbiAgX3NldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIC8vXCIuY2FyZF9fbGlrZS1idXR0b25cIlxuICAgIHRoaXMuX2xpa2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUxpa2VJY29uKHRoaXMpO1xuICAgIH0pO1xuXG4gICAgLy9cIi5jYXJkX19kZWxldGUtYnV0dG9uXCJcbiAgICB0aGlzLl9kZWxldGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZURlbGV0ZUNhcmQodGhpcyk7XG4gICAgfSk7XG4gICAgLy9pbWFnZSBwcmV2aWV3XG4gICAgdGhpcy5fY2FyZEltYWdlRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICAgIHRoaXMuX2hhbmRsZUltYWdlQ2xpY2soe1xuICAgICAgICBuYW1lOiB0aGlzLl9uYW1lLFxuICAgICAgICBsaW5rOiB0aGlzLl9saW5rLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBnZXRWaWV3KCkge1xuICAgIHRoaXMuX2NhcmRFbGVtZW50ID0gZG9jdW1lbnRcbiAgICAgIC5xdWVyeVNlbGVjdG9yKHRoaXMuX2NhcmRTZWxlY3RvcilcbiAgICAgIC5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKVxuICAgICAgLmNsb25lTm9kZSh0cnVlKTtcbiAgICB0aGlzLl9saWtlQnRuID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgICB0aGlzLl9kZWxldGVCdG4gPSB0aGlzLl9jYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2RlbGV0ZS1idXR0b25cIik7XG4gICAgLy9nZXQgdGhlIGNhcmQgdmlld1xuICAgIHRoaXMuX2NhcmRJbWFnZUVsID0gdGhpcy5fY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19pbWFnZVwiKTtcbiAgICB0aGlzLl9jYXJkVGl0bGVFbCA9IHRoaXMuX2NhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gICAgdGhpcy5fY2FyZEltYWdlRWwuc3JjID0gdGhpcy5fbGluaztcbiAgICB0aGlzLl9jYXJkSW1hZ2VFbC5hbHQgPSB0aGlzLl9kYXRhLm5hbWUgKyBcIiBcIiArIFwiSW1hZ2VcIjtcbiAgICB0aGlzLl9jYXJkVGl0bGVFbC50ZXh0Q29udGVudCA9IHRoaXMuX2RhdGEubmFtZTtcbiAgICAvL3NldCBldmVudCBsaXN0ZW5lcnNcbiAgICB0aGlzLl9zZXRFdmVudExpc3RlbmVycygpO1xuICAgIHRoaXMuX3JlbmRlckxpa2VzKCk7XG4gICAgLy9yZXR1cm4gdGhlIGNhcmRcbiAgICByZXR1cm4gdGhpcy5fY2FyZEVsZW1lbnQ7XG4gIH1cblxuICByZW1vdmVDYXJkRWxlbWVudCgpIHtcbiAgICB0aGlzLl9jYXJkRWxlbWVudC5yZW1vdmUoKTtcbiAgICB0aGlzLl9jYXJkRWxlbWVudCA9IG51bGw7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEZvcm1WYWxpZGF0b3Ige1xuICBjb25zdHJ1Y3Rvcihjb25maWcsIGZvcm1FbCkge1xuICAgIHRoaXMuX2lucHV0U2VsZWN0b3IgPSBjb25maWcuaW5wdXRTZWxlY3RvcjtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b25TZWxlY3RvciA9IGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3RvcjtcbiAgICB0aGlzLl9pbmFjdGl2ZUJ1dHRvbkNsYXNzID0gY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3M7XG4gICAgdGhpcy5faW5wdXRFcnJvckNsYXNzID0gY29uZmlnLmlucHV0RXJyb3JDbGFzcztcbiAgICB0aGlzLl9lcnJvckNsYXNzID0gY29uZmlnLmVycm9yQ2xhc3M7XG5cbiAgICB0aGlzLl9mb3JtID0gZm9ybUVsO1xuICB9XG5cbiAgX3Nob3dJbnB1dEVycm9yKGlucHV0RWwpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWwuaWR9LWVycm9yYFxuICAgICk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QuYWRkKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpIHtcbiAgICBjb25zdCBlcnJvck1lc3NhZ2VFbGVtZW50ID0gdGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yKFxuICAgICAgYCMke2lucHV0RWwuaWR9LWVycm9yYFxuICAgICk7XG4gICAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2lucHV0RXJyb3JDbGFzcyk7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC50ZXh0Q29udGVudCA9IFwiXCI7XG4gICAgZXJyb3JNZXNzYWdlRWxlbWVudC5jbGFzc0xpc3QucmVtb3ZlKHRoaXMuX2Vycm9yQ2xhc3MpO1xuICB9XG5cbiAgX2NoZWNrSW5wdXRWYWxpZGl0eShpbnB1dEVsKSB7XG4gICAgaWYgKCFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKSB7XG4gICAgICByZXR1cm4gdGhpcy5fc2hvd0lucHV0RXJyb3IoaW5wdXRFbCk7XG4gICAgfVxuXG4gICAgdGhpcy5faGlkZUlucHV0RXJyb3IoaW5wdXRFbCk7XG4gIH1cblxuICBfaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xuICAgIHJldHVybiAhaW5wdXRMaXN0LmV2ZXJ5KChpbnB1dEVsKSA9PiBpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcbiAgfVxuXG4gIGRpc2FibGVCdXR0b24oKSB7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5hZGQodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgfVxuXG4gIF9lbmFibGVCdXR0b24oKSB7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmNsYXNzTGlzdC5yZW1vdmUodGhpcy5faW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uLmRpc2FibGVkID0gZmFsc2U7XG4gIH1cblxuICBfdG9nZ2xlQnV0dG9uU3RhdGUoKSB7XG4gICAgaWYgKHRoaXMuX2hhc0ludmFsaWRJbnB1dCh0aGlzLl9pbnB1dEVscykpIHtcbiAgICAgIHRoaXMuZGlzYWJsZUJ1dHRvbigpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9lbmFibGVCdXR0b24oKTtcbiAgICB9XG4gIH1cblxuICBfc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgdGhpcy5faW5wdXRFbHMgPSBbLi4udGhpcy5fZm9ybS5xdWVyeVNlbGVjdG9yQWxsKHRoaXMuX2lucHV0U2VsZWN0b3IpXTtcbiAgICB0aGlzLl9zdWJtaXRCdXR0b24gPSB0aGlzLl9mb3JtLnF1ZXJ5U2VsZWN0b3IodGhpcy5fc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gICAgdGhpcy5faW5wdXRFbHMuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgICB0aGlzLl9jaGVja0lucHV0VmFsaWRpdHkoaW5wdXRFbCk7XG4gICAgICAgIHRoaXMuX3RvZ2dsZUJ1dHRvblN0YXRlKCk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGVuYWJsZVZhbGlkYXRpb24oKSB7XG4gICAgdGhpcy5fZm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgICAgIGV2dC5wcmV2ZW50RGVmYXVsdChldnQpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgfVxuXG4gIHJlc2V0VmFsaWRhdGlvbigpIHtcbiAgICB0aGlzLl90b2dnbGVCdXR0b25TdGF0ZSgpO1xuICAgIHRoaXMuX2lucHV0RWxzLmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICAgIHRoaXMuX2hpZGVJbnB1dEVycm9yKGlucHV0RWwpO1xuICAgIH0pO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBTZWN0aW9uIHtcbiAgY29uc3RydWN0b3IoeyBpdGVtcywgcmVuZGVyZXIgfSwgY2xhc3NTZWxlY3Rvcikge1xuICAgIHRoaXMuX2l0ZW1zID0gaXRlbXM7XG4gICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcbiAgICB0aGlzLl9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGNsYXNzU2VsZWN0b3IpO1xuICB9XG4gIHJlbmRlckl0ZW1zKCkge1xuICAgIHRoaXMuX2l0ZW1zLmZvckVhY2goKGl0ZW0pID0+IHtcbiAgICAgIHRoaXMuX3JlbmRlcmVyKGl0ZW0pO1xuICAgIH0pO1xuICB9XG5cbiAgYWRkSXRlbShpdGVtKSB7XG4gICAgdGhpcy5fY29udGFpbmVyLnByZXBlbmQoaXRlbSk7XG4gIH1cbn1cbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IoeyBwb3B1cFNlbGVjdG9yIH0pIHtcbiAgICB0aGlzLl9wb3B1cEVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKHBvcHVwU2VsZWN0b3IpO1xuICAgIHRoaXMuX2hhbmRsZUVzY0Nsb3NlID0gdGhpcy5faGFuZGxlRXNjQ2xvc2UuYmluZCh0aGlzKTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgLy9vcGVucyBwb3B1cFxuICAgIHRoaXMuX3BvcHVwRWxlbWVudC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfb3BlbmVkXCIpO1xuICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIHRoaXMuX2hhbmRsZUVzY0Nsb3NlKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIC8vY2xvc2VzIHBvcHVwXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9vcGVuZWRcIik7XG4gICAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgdGhpcy5faGFuZGxlRXNjQ2xvc2UpO1xuICB9XG5cbiAgX2hhbmRsZUVzY0Nsb3NlKGV2dCkge1xuICAgIC8vbGlzdGVuZXMgRXNjIGJ1dHRvblxuICAgIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgICB0aGlzLmNsb3NlKCk7XG4gICAgfVxuICB9XG5cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgLy9zZXRzIGV2dCBsaXN0ZW5lcnNcbiAgICB0aGlzLl9wb3B1cENsb3NlQnRuID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gICAgICBcIi5tb2RhbF9fY2xvc2UtYnV0dG9uXCJcbiAgICApO1xuXG4gICAgdGhpcy5fcG9wdXBDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgIH0pO1xuXG4gICAgdGhpcy5fcG9wdXBFbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZ0KSA9PiB7XG4gICAgICBpZiAoZXZ0LnRhcmdldCA9PT0gZXZ0LmN1cnJlbnRUYXJnZXQpIHtcbiAgICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG59XG4iLCJpbXBvcnQgUG9wdXAgZnJvbSBcIi4vUG9wdXAuanNcIjtcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBvcHVwV2l0aEZvcm0gZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IsIGhhbmRsZUZvcm1TdWJtaXQpIHtcbiAgICBzdXBlcih7IHBvcHVwU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gICAgdGhpcy5fc3VibWl0QnV0dG9uID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2J1dHRvblwiKTtcbiAgfVxuXG4gIHZpZXdMb2FkaW5nKGlzTG9hZGluZykge1xuICAgIGlmIChpc0xvYWRpbmcpIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2aW5nLi4uXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3N1Ym1pdEJ1dHRvbi50ZXh0Q29udGVudCA9IFwiU2F2ZVwiO1xuICAgIH1cbiAgfVxuXG4gIF9nZXRJbnB1dFZhbHVlcygpIHtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzID0gQXJyYXkuZnJvbShcbiAgICAgIHRoaXMuX3BvcHVwRm9ybS5xdWVyeVNlbGVjdG9yQWxsKFwiLm1vZGFsX19maWVsZFwiKVxuICAgICk7XG4gICAgY29uc3QgaW5wdXRWYWx1ZXMgPSB7fTtcbiAgICB0aGlzLl9pbnB1dEVsZW1lbnRzLmZvckVhY2goKGlucHV0KSA9PiB7XG4gICAgICBpbnB1dFZhbHVlc1tpbnB1dC5uYW1lXSA9IGlucHV0LnZhbHVlO1xuICAgIH0pO1xuICAgIHJldHVybiBpbnB1dFZhbHVlcztcbiAgfVxuXG4gIHNldEV2ZW50TGlzdGVuZXJzKCkge1xuICAgIHN1cGVyLnNldEV2ZW50TGlzdGVuZXJzKCk7XG4gICAgdGhpcy5fcG9wdXBGb3JtLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGV2dCkgPT4ge1xuICAgICAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB0aGlzLl9oYW5kbGVGb3JtU3VibWl0KHRoaXMuX2dldElucHV0VmFsdWVzKCkpO1xuICAgIH0pO1xuICB9XG5cbiAgcmVzZXRGb3JtKCkge1xuICAgIHRoaXMuX3BvcHVwRm9ybS5yZXNldCgpO1xuICB9XG59XG4iLCIvL2V4cG9ydCBjb25zdCBpbml0aWFsQ2FyZHMgPSBbXG4vL3tcbi8vbmFtZTogXCJZb3NlbWl0ZSBWYWxsZXlcIixcbi8vbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L3lvc2VtaXRlLmpwZ1wiLFxuLy99LFxuLy97XG4vL25hbWU6IFwiTGFrZSBMb3Vpc2VcIixcbi8vbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xha2UtbG91aXNlLmpwZ1wiLFxuLy99LFxuLy97XG4vLyBuYW1lOiBcIkJhbGQgTW91bnRhaW5zXCIsXG4vL2xpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9iYWxkLW1vdW50YWlucy5qcGdcIixcbi8vfSxcbi8ve1xuLy9uYW1lOiBcIkxhdGVtYXJcIixcbi8vbGluazogXCJodHRwczovL3ByYWN0aWN1bS1jb250ZW50LnMzLnVzLXdlc3QtMS5hbWF6b25hd3MuY29tL3NvZnR3YXJlLWVuZ2luZWVyL2Fyb3VuZC1wcm9qZWN0L2xhdGVtYXIuanBnXCIsXG4vL30sXG4vL3tcbi8vbmFtZTogXCJWYW5vaXNlIE5hdGlvbmFsIFBhcmtcIixcbi8vIGxpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC92YW5vaXNlLmpwZ1wiLFxuLy8gfSxcbi8ve1xuLy9uYW1lOiBcIkxhZ28gZGkgQnJhaWVzXCIsXG4vL2xpbms6IFwiaHR0cHM6Ly9wcmFjdGljdW0tY29udGVudC5zMy51cy13ZXN0LTEuYW1hem9uYXdzLmNvbS9zb2Z0d2FyZS1lbmdpbmVlci9hcm91bmQtcHJvamVjdC9sYWdvLmpwZ1wiLFxuLy99LFxuLy9dO1xuXG5leHBvcnQgY29uc3QgY29uZmlnID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19maWVsZFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX2J1dHRvblwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19idXR0b25fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2Vycm9yX3Zpc2libGVcIixcbn07XG5cbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tZm9ybXMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdEZvcm0gPSBkb2N1bWVudC5mb3Jtc1tcImFkZC1wcm9maWxlLWZvcm1cIl07XG5leHBvcnQgY29uc3QgYWRkQ2FyZEZvcm1FbGVtZW50ID0gZG9jdW1lbnQuZm9ybXNbXCJhZGQtY2FyZC1mb3JtXCJdO1xuZXhwb3J0IGNvbnN0IGVkaXRBdmF0YXJGb3JtID0gZG9jdW1lbnQuZm9ybXNbXCJhZGQtYXZhdGFyLWZvcm1cIl07XG4vLy0tLS0tLS0tLS0tLS0tLS0tLS0tLS1wYWdlIGJ1dHRvbnMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vXG5leHBvcnQgY29uc3QgcHJvZmlsZUVkaXRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3Byb2ZpbGUtZWRpdC1idXR0b25cIik7XG5leHBvcnQgY29uc3QgYWRkTmV3Q2FyZEJ1dHRvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hZGQtYnV0dG9uXCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVBdmF0YXJCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNhdmF0YXItZWRpdC1idXR0b25cIlxuKTtcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1jYXJkcy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xuZXhwb3J0IGNvbnN0IGNhcmRMaXN0RWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmdhbGxlcnlfX2NhcmRzXCIpO1xuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXByZXZldyBpbWFnZSBlbGVtZW50LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS8vXG5leHBvcnQgY29uc3QgcHJldmlld1BvcHVwID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNtb2RhbC1pbWFnZVwiKTtcbmV4cG9ydCBjb25zdCBpbWFnZVByZXZpZXdQb3B1cCA9IHByZXZpZXdQb3B1cC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbmV4cG9ydCBjb25zdCB0aXRsZVByZXZpZXdQb3B1cCA9IHByZXZpZXdQb3B1cC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9faW1hZ2UtdGl0bGVcIlxuKTtcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1wcm9maWxlIGlucHV0cy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cbmV4cG9ydCBjb25zdCBwcm9maWxlRWRpdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLWVkaXQtbW9kYWxcIik7XG5leHBvcnQgY29uc3QgcHJvZmlsZVRpdGxlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX190aXRsZVwiKTtcbmV4cG9ydCBjb25zdCBwcm9maWxlRGVzY3JpcHRpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiXG4pO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVUaXRsZUlucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcm9maWxlLXRpdGxlLWlucHV0XCIpO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVEZXNjcmlwdGlvbklucHV0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuZXhwb3J0IGNvbnN0IHByb2ZpbGVDbG9zZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtbW9kYWwtY2xvc2UtYnV0dG9uXCJcbik7XG5leHBvcnQgY29uc3QgY2FyZFRlbXBsYXRlID1cbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpLmNvbnRlbnQuZmlyc3RFbGVtZW50Q2hpbGQ7XG5leHBvcnQgY29uc3QgY2FyZEVkaXRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1lZGl0LW1vZGFsXCIpO1xuZXhwb3J0IGNvbnN0IGNhcmRNb2RhbENsb3NlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcbiAgXCIjY2FyZC1tb2RhbC1jbG9zZS1idXR0b25cIlxuKTtcbmV4cG9ydCBjb25zdCBjYXJkVGl0bGVJbnB1dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC10aXRsZS1pbnB1dFwiKTtcbmV4cG9ydCBjb25zdCBjYXJkVXJsSW5wdXQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2ltYWdlLVVSTC1pbnB1dFwiKTtcbmV4cG9ydCBjb25zdCBpbWFnZU1vZGFsQ2xvc2VCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFxuICBcIiNpbWFnZS1tb2RhbC1jbG9zZS1idXR0b25cIlxuKTtcbiIsImltcG9ydCBDYXJkIGZyb20gXCIuLi9jb21wb25lbnRzL0NhcmQuanNcIjtcbmltcG9ydCBGb3JtVmFsaWRhdG9yIGZyb20gXCIuLi9jb21wb25lbnRzL0Zvcm1WYWxpZGF0b3IuanNcIjtcbmltcG9ydCBTZWN0aW9uIGZyb20gXCIuLi9jb21wb25lbnRzL1NlY3Rpb24uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhGb3JtIGZyb20gXCIuLi9jb21wb25lbnRzL1BvcHVwV2l0aEZvcm0uanNcIjtcbmltcG9ydCBQb3B1cFdpdGhJbWFnZSBmcm9tIFwiLi4vY29tcG9uZW50cy9Qb3B1cFdpdGhJbWFnZS5qc1wiO1xuaW1wb3J0IFVzZXJJbmZvIGZyb20gXCIuLi9jb21wb25lbnRzL1VzZXJJbmZvLmpzXCI7XG5pbXBvcnQgXCIuLi9wYWdlcy9pbmRleC5jc3NcIjtcbmltcG9ydCB7XG4gIC8vaW5pdGlhbENhcmRzLFxuICBjb25maWcsXG4gIHByb2ZpbGVFZGl0Rm9ybSxcbiAgYWRkQ2FyZEZvcm1FbGVtZW50LFxuICBwcm9maWxlRWRpdEJ1dHRvbixcbiAgYWRkTmV3Q2FyZEJ1dHRvbixcbiAgcHJvZmlsZVRpdGxlSW5wdXQsXG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LFxuICBwcm9maWxlQXZhdGFyQnV0dG9uLFxuICBlZGl0QXZhdGFyRm9ybSxcbiAgLy9jYXJkTGlzdEVsLFxufSBmcm9tIFwiLi4vdXRpbHMvY29uc3RhbnRzLmpzXCI7XG5pbXBvcnQgQXBpIGZyb20gXCIuLi9jb21wb25lbnRzL0FwaS5qc1wiO1xuaW1wb3J0IFBvcHVwQ29uZmlybURlbGV0ZSBmcm9tIFwiLi4vY29tcG9uZW50cy9wb3B1cENvbmZpcm1EZWxldGUuanNcIjtcbi8vLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLUFQSS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjA5NmViMDU5LTgyNDktNDMyYy1hZWQ1LWVhNmYwZDE4YzFkNVwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmNvbnN0IHVzZXJJbmZvID0gbmV3IFVzZXJJbmZvKFxuICBcIi5wcm9maWxlX190aXRsZVwiLFxuICBcIi5wcm9maWxlX19kZXNjcmlwdGlvblwiLFxuICBcIi5wcm9maWxlX19pbWFnZVwiXG4pO1xuXG5sZXQgY2FyZFNlY3Rpb247XG5hcGlcbiAgLmdldEluaXRpYWxDYXJkcygpXG4gIC50aGVuKChjYXJkRGF0YSkgPT4ge1xuICAgIGNhcmRTZWN0aW9uID0gbmV3IFNlY3Rpb24oXG4gICAgICB7XG4gICAgICAgIGl0ZW1zOiBjYXJkRGF0YSxcbiAgICAgICAgcmVuZGVyZXI6IChjYXJkRGF0YSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpO1xuICAgICAgICAgIGNhcmRTZWN0aW9uLmFkZEl0ZW0oY2FyZEVsZW1lbnQpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIFwiLmdhbGxlcnlfX2NhcmRzXCJcbiAgICApO1xuICAgIGNhcmRTZWN0aW9uLnJlbmRlckl0ZW1zKCk7XG4gIH0pXG4gIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuXG5hcGkuZ2V0VXNlcigpLnRoZW4oKGlucHV0VmFsdWVzKSA9PiB7XG4gIHVzZXJJbmZvLnNldFVzZXJJbmZvKGlucHV0VmFsdWVzLm5hbWUsIGlucHV0VmFsdWVzLmFib3V0KTtcbn0pO1xuXG5mdW5jdGlvbiBoYW5kbGVBZGRDYXJkRm9ybVN1Ym1pdChjYXJkRGF0YSkge1xuICBuZXdDYXJkUG9wdXAudmlld0xvYWRpbmcodHJ1ZSk7XG4gIGFwaVxuICAgIC5hZGRDYXJkKGNhcmREYXRhKVxuICAgIC50aGVuKChjYXJkRGF0YSkgPT4ge1xuICAgICAgY2FyZFNlY3Rpb24uYWRkSXRlbShcbiAgICAgICAgZ2V0Q2FyZEVsZW1lbnQoeyBuYW1lOiBjYXJkRGF0YS5uYW1lLCBsaW5rOiBjYXJkRGF0YS5saW5rIH0pXG4gICAgICApO1xuICAgICAgYWRkQ2FyZFZhbGlkYXRvci5kaXNhYmxlQnV0dG9uKCk7XG4gICAgICBuZXdDYXJkUG9wdXAucmVzZXRGb3JtKCk7XG4gICAgICBuZXdDYXJkUG9wdXAuY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycihlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgbmV3Q2FyZFBvcHVwLnZpZXdMb2FkaW5nKGZhbHNlKTtcbiAgICB9KTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tZXZlbnQgaGFuZGxlcnMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xuZnVuY3Rpb24gaGFuZGxlSW1hZ2VDbGljayhjYXJkRGF0YSkge1xuICBwb3B1cEltYWdlLm9wZW4oY2FyZERhdGEpO1xufVxuXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdChpbnB1dFZhbHVlcykge1xuICBwcm9maWxlRWRpdFBvcHVwLnZpZXdMb2FkaW5nKHRydWUpO1xuICBhcGlcbiAgICAuZWRpdFByb2ZpbGUoaW5wdXRWYWx1ZXMubmFtZSwgaW5wdXRWYWx1ZXMuYWJvdXQpXG4gICAgLnRoZW4oKHJlcykgPT4ge1xuICAgICAgdXNlckluZm8uc2V0VXNlckluZm8ocmVzKTtcbiAgICAgIHByb2ZpbGVFZGl0VmFsaWRhdG9yLmRpc2FibGVCdXR0b24oKTtcbiAgICAgIHByb2ZpbGVFZGl0UG9wdXAuY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycihlcnIpO1xuICAgIH0pXG4gICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgYXZhdGFyRWRpdFBvcHVwLnZpZXdMb2FkaW5nKGZhbHNlKTtcbiAgICB9KTtcbn1cblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLWV2ZW50IGxpc3RlbmVycy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLy9cbmFkZE5ld0NhcmRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgbmV3Q2FyZFBvcHVwLm9wZW4oKTtcbn0pO1xuXG5wcm9maWxlRWRpdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBjb25zdCBkYXRhID0gdXNlckluZm8uZ2V0VXNlckluZm8oKTtcbiAgcHJvZmlsZVRpdGxlSW5wdXQudmFsdWUgPSBkYXRhLm5hbWU7XG4gIHByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gZGF0YS5hYm91dDtcbiAgcHJvZmlsZUVkaXRQb3B1cC5vcGVuKCk7XG59KTtcblxuLy8tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1mdW5jdGlvbnMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xuZnVuY3Rpb24gZ2V0Q2FyZEVsZW1lbnQoY2FyZERhdGEpIHtcbiAgY29uc3QgY2FyZCA9IG5ldyBDYXJkKFxuICAgIGNhcmREYXRhLFxuICAgIFwiI2NhcmQtdGVtcGxhdGVcIixcbiAgICBoYW5kbGVJbWFnZUNsaWNrLFxuICAgIGhhbmRsZURlbGV0ZUNhcmQsXG4gICAgaGFuZGxlTGlrZUljb25cbiAgKTtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkLmdldFZpZXcoKTtcbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG4vLy0tLS0tLS0tLS0tLS0tLS0taW5zdGFudGlhdGlvbnMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0vL1xuY29uc3QgcHJvZmlsZUVkaXRWYWxpZGF0b3IgPSBuZXcgRm9ybVZhbGlkYXRvcihjb25maWcsIHByb2ZpbGVFZGl0Rm9ybSk7XG5jb25zdCBhZGRDYXJkVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uZmlnLCBhZGRDYXJkRm9ybUVsZW1lbnQpO1xuY29uc3QgYWRkQXZhdGFyVmFsaWRhdG9yID0gbmV3IEZvcm1WYWxpZGF0b3IoY29uZmlnLCBlZGl0QXZhdGFyRm9ybSk7XG5cbnByb2ZpbGVFZGl0VmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcbmFkZENhcmRWYWxpZGF0b3IuZW5hYmxlVmFsaWRhdGlvbigpO1xuYWRkQXZhdGFyVmFsaWRhdG9yLmVuYWJsZVZhbGlkYXRpb24oKTtcblxuY29uc3QgcG9wdXBJbWFnZSA9IG5ldyBQb3B1cFdpdGhJbWFnZShcIiNtb2RhbC1pbWFnZVwiKTtcbnBvcHVwSW1hZ2Uuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuY29uc3QgbmV3Q2FyZFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiI2NhcmQtZWRpdC1tb2RhbFwiLFxuICBoYW5kbGVBZGRDYXJkRm9ybVN1Ym1pdFxuKTtcbm5ld0NhcmRQb3B1cC5zZXRFdmVudExpc3RlbmVycygpO1xuXG5jb25zdCBwcm9maWxlRWRpdFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiI3Byb2ZpbGUtZWRpdC1tb2RhbFwiLFxuICBoYW5kbGVQcm9maWxlRWRpdFN1Ym1pdFxuKTtcbnByb2ZpbGVFZGl0UG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuZnVuY3Rpb24gaGFuZGxlTGlrZUljb24oY2FyZCkge1xuICBpZiAoY2FyZC5pc0xpa2VkKSB7XG4gICAgYXBpXG4gICAgICAucmVtb3ZlTGlrZShjYXJkLmlkKVxuICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICBjYXJkLnNldElzTGlrZWQoZmFsc2UpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuICB9IGVsc2Uge1xuICAgIGFwaVxuICAgICAgLmFkZExpa2UoY2FyZC5pZClcbiAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgY2FyZC5zZXRJc0xpa2VkKHRydWUpO1xuICAgICAgfSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKGVycikpO1xuICB9XG59XG5cbmNvbnN0IGRlbGV0ZUNhcmRQb3B1cCA9IG5ldyBQb3B1cENvbmZpcm1EZWxldGUoXCIjbW9kYWwtZGVsZXRlLWNhcmRcIik7XG5kZWxldGVDYXJkUG9wdXAuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcblxuZnVuY3Rpb24gaGFuZGxlRGVsZXRlQ2FyZChjYXJkKSB7XG4gIGRlbGV0ZUNhcmRQb3B1cC5vcGVuKCk7XG4gIGRlbGV0ZUNhcmRQb3B1cC5zZXRDb25maXJtRGVsZXRlKCgpID0+IHtcbiAgICBhcGlcbiAgICAgIC5yZW1vdmVDYXJkKGNhcmQuaWQpXG4gICAgICAudGhlbigoKSA9PiB7XG4gICAgICAgIGNhcmQucmVtb3ZlQ2FyZEVsZW1lbnQoKTtcbiAgICAgICAgZGVsZXRlQ2FyZFBvcHVwLmNsb3NlKCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG4gIH0pO1xufVxuXG5wcm9maWxlQXZhdGFyQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIGF2YXRhckVkaXRQb3B1cC5vcGVuKCk7XG59KTtcblxuY29uc3QgYXZhdGFyRWRpdFBvcHVwID0gbmV3IFBvcHVwV2l0aEZvcm0oXG4gIFwiI21vZGFsLXVwZGF0ZS1hdmF0YXJcIixcbiAgaGFuZGxlQXZhdGFyU3VibWl0XG4pO1xuYXZhdGFyRWRpdFBvcHVwLnNldEV2ZW50TGlzdGVuZXJzKCk7XG5cbmZ1bmN0aW9uIGhhbmRsZUF2YXRhclN1Ym1pdCh7IGxpbmsgfSkge1xuICBhdmF0YXJFZGl0UG9wdXAudmlld0xvYWRpbmcodHJ1ZSk7XG4gIGFwaVxuICAgIC51cGRhdGVBdmF0YXIobGluaylcbiAgICAudGhlbigoKSA9PiB7XG4gICAgICB1c2VySW5mby5zZXRBdmF0YXIobGluayk7XG4gICAgICBhdmF0YXJFZGl0UG9wdXAuY2xvc2UoKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgfSlcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBhdmF0YXJFZGl0UG9wdXAudmlld0xvYWRpbmcoZmFsc2UpO1xuICAgIH0pO1xufVxuIiwiZXhwb3J0IGRlZmF1bHQgY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIGdldFVzZXJJbmZvQW5kQ2FyZHMoKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldEluaXRpYWxDYXJkcygpLCB0aGlzLmdldFVzZXIoKV0pO1xuICB9XG5cbiAgX2NoZWNrUmVzcG9uc2UocmVzKSB7XG4gICAgaWYgKHJlcy5vaykge1xuICAgICAgcmV0dXJuIHJlcy5qc29uKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChgRXJyb3I6ICR7cmVzLnN0YXR1c31gKTtcbiAgICB9XG4gIH1cblxuICAvLy0tLS0tQ0FSRCBST1VURTogR2V0IGFsbCBjYXJkcyAoR0VUKS0tLS0vL1xuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwgeyBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzIH0pXG4gICAgICAudGhlbih0aGlzLl9jaGVja1Jlc3BvbnNlKVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnIpO1xuICAgICAgfSk7XG4gIH1cblxuICAvLy0tLS1VU0VSIFJPVVRFOiBHZXQgdGhlIGN1cnJlbnQgdXNlcuKAmXMgaW5mbyAoR0VUKS0tLS0tLy9cbiAgZ2V0VXNlcigpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vdXNlcnMvbWVgLCB7IGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMgfSlcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9KTtcbiAgfVxuXG4gIC8vLS0tLS0tQ0FSRCBST1VURTogQ3JlYXRlIGEgY2FyZCAoUE9TVCktLS0tLS8vXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgLy8tLS0tLS0tLS0tLS1VU0VSIFJPVVRFOiBVcGRhdGUgcHJvZmlsZSBpbmZvcm1hdGlvbiAoUEFUQ0gpLS0tLS8vL1xuICBlZGl0UHJvZmlsZShuYW1lLCBhYm91dCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgYWJvdXQgfSksXG4gICAgfSlcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9KTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS0tQ0FSRCBST1VURTogRGVsZXRlIGEgY2FyZCAoREVMRVRFKS0tLS0tLy9cbiAgcmVtb3ZlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH0pO1xuICB9XG4gIC8vLS0tLS0tLS0tLS1DQVJEIFJPVVRFOiBMaWtlIGEgY2FyZCAoUFVUKS0tLS0vL1xuICBhZGRMaWtlKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXMvYCwge1xuICAgICAgbWV0aG9kOiBcIlBVVFwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaXNMaWtlZDogdHJ1ZSB9KSxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH0pO1xuICB9XG4gIC8vLS0tLS0tLS0tLS1DQVJEIFJPVVRFOiBEaXNsaWtlIGEgY2FyZCAoREVMRVRFKS0tLS0vL1xuICByZW1vdmVMaWtlKGNhcmRJZCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXMvYCwge1xuICAgICAgbWV0aG9kOiBcIkRFTEVURVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaXNMaWtlZDogZmFsc2UgfSksXG4gICAgfSlcbiAgICAgIC50aGVuKHRoaXMuX2NoZWNrUmVzcG9uc2UpXG4gICAgICAuY2F0Y2goKGVycikgPT4ge1xuICAgICAgICBjb25zb2xlLmVycm9yKGVycik7XG4gICAgICB9KTtcbiAgfVxuICAvLy0tLS0tLS0tLS0tLS1VU0VSIFJPVVRFOiBVcGRhdGUgYXZhdGFyIChQQVRDSCktLS0tLy9cbiAgdXBkYXRlQXZhdGFyKGF2YXRhcikge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGF2YXRhciB9KSxcbiAgICB9KVxuICAgICAgLnRoZW4odGhpcy5fY2hlY2tSZXNwb25zZSlcbiAgICAgIC5jYXRjaCgoZXJyKSA9PiB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyKTtcbiAgICAgIH0pO1xuICB9XG59XG4iLCJleHBvcnQgZGVmYXVsdCBjbGFzcyBVc2VySW5mbyB7XG4gIGNvbnN0cnVjdG9yKG5hbWUsIGFib3V0LCBhdmF0YXIpIHtcbiAgICB0aGlzLl9uYW1lID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihuYW1lKTtcbiAgICB0aGlzLl9hYm91dCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYWJvdXQpO1xuICAgIHRoaXMuX2F2YXRhciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYXZhdGFyKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiB7XG4gICAgICBuYW1lOiB0aGlzLl9uYW1lLnRleHRDb250ZW50LFxuICAgICAgYWJvdXQ6IHRoaXMuX2Fib3V0LnRleHRDb250ZW50LFxuICAgIH07XG4gIH1cblxuICBzZXRVc2VySW5mbyhuYW1lLCBhYm91dCkge1xuICAgIHRoaXMuX25hbWUudGV4dENvbnRlbnQgPSBuYW1lO1xuICAgIHRoaXMuX2Fib3V0LnRleHRDb250ZW50ID0gYWJvdXQ7XG4gIH1cblxuICBzZXRBdmF0YXIoYXZhdGFyKSB7XG4gICAgdGhpcy5fYXZhdGFyLnNyYyA9IGF2YXRhcjtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cFdpdGhJbWFnZSBleHRlbmRzIFBvcHVwIHtcbiAgY29uc3RydWN0b3IocG9wdXBTZWxlY3Rvcikge1xuICAgIHN1cGVyKHsgcG9wdXBTZWxlY3RvciB9KTtcbiAgICB0aGlzLl9wcmV2aWV3SW1hZ2VFbGVtZW50ID1cbiAgICAgIHRoaXMuX3BvcHVwRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19pbWFnZVwiKTtcbiAgICB0aGlzLl9wcmV2aWV3SW1hZ2VFbGVtZW50VGl0bGUgPSB0aGlzLl9wb3B1cEVsZW1lbnQucXVlcnlTZWxlY3RvcihcbiAgICAgIFwiLm1vZGFsX19pbWFnZS10aXRsZVwiXG4gICAgKTtcbiAgfVxuICBvcGVuKGNhcmREYXRhKSB7XG4gICAgdGhpcy5fcHJldmlld0ltYWdlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgY2FyZERhdGEubGluayk7XG4gICAgdGhpcy5fcHJldmlld0ltYWdlRWxlbWVudC5zZXRBdHRyaWJ1dGUoXG4gICAgICBcImFsdFwiLFxuICAgICAgY2FyZERhdGEubmFtZSArIFwiIFwiICsgXCJJbWFnZVwiXG4gICAgKTtcbiAgICB0aGlzLl9wcmV2aWV3SW1hZ2VFbGVtZW50VGl0bGUudGV4dENvbnRlbnQgPSBjYXJkRGF0YS5uYW1lO1xuICAgIHN1cGVyLm9wZW4oKTtcbiAgfVxufVxuIiwiaW1wb3J0IFBvcHVwIGZyb20gXCIuL1BvcHVwLmpzXCI7XG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQb3B1cENvbmZpcm1EZWxldGUgZXh0ZW5kcyBQb3B1cCB7XG4gIGNvbnN0cnVjdG9yKHBvcHVwU2VsZWN0b3IpIHtcbiAgICBzdXBlcih7IHBvcHVwU2VsZWN0b3IgfSk7XG4gICAgdGhpcy5fcG9wdXBGb3JtID0gdGhpcy5fcG9wdXBFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG4gIH1cbiAgc2V0Q29uZmlybURlbGV0ZShoYW5kbGVGb3JtU3VibWl0KSB7XG4gICAgdGhpcy5faGFuZGxlRm9ybVN1Ym1pdCA9IGhhbmRsZUZvcm1TdWJtaXQ7XG4gIH1cbiAgc2V0RXZlbnRMaXN0ZW5lcnMoKSB7XG4gICAgc3VwZXIuc2V0RXZlbnRMaXN0ZW5lcnMoKTtcbiAgICB0aGlzLl9wb3B1cEZvcm0uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHRoaXMuX2hhbmRsZUZvcm1TdWJtaXQoKTtcbiAgICB9KTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIkNhcmQiLCJjb25zdHJ1Y3RvciIsIl9yZWYiLCJjYXJkU2VsZWN0b3IiLCJoYW5kbGVJbWFnZUNsaWNrIiwiaGFuZGxlRGVsZXRlQ2FyZCIsImhhbmRsZUxpa2VJY29uIiwibmFtZSIsImxpbmsiLCJfaWQiLCJpc0xpa2VkIiwidGhpcyIsIl9kYXRhIiwiX25hbWUiLCJfbGluayIsImlkIiwiX2NhcmRTZWxlY3RvciIsIl9oYW5kbGVJbWFnZUNsaWNrIiwiX2hhbmRsZURlbGV0ZUNhcmQiLCJfaGFuZGxlTGlrZUljb24iLCJnZXRMaWtlZFN0YXR1cyIsInNldElzTGlrZWQiLCJfcmVuZGVyTGlrZXMiLCJfbGlrZUJ0biIsImNsYXNzTGlzdCIsImFkZCIsInJlbW92ZSIsIl9zZXRFdmVudExpc3RlbmVycyIsImFkZEV2ZW50TGlzdGVuZXIiLCJfZGVsZXRlQnRuIiwiX2NhcmRJbWFnZUVsIiwiZ2V0VmlldyIsIl9jYXJkRWxlbWVudCIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsImNvbnRlbnQiLCJjbG9uZU5vZGUiLCJfY2FyZFRpdGxlRWwiLCJzcmMiLCJhbHQiLCJ0ZXh0Q29udGVudCIsInJlbW92ZUNhcmRFbGVtZW50IiwiRm9ybVZhbGlkYXRvciIsImNvbmZpZyIsImZvcm1FbCIsIl9pbnB1dFNlbGVjdG9yIiwiaW5wdXRTZWxlY3RvciIsIl9zdWJtaXRCdXR0b25TZWxlY3RvciIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiX2luYWN0aXZlQnV0dG9uQ2xhc3MiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiX2lucHV0RXJyb3JDbGFzcyIsImlucHV0RXJyb3JDbGFzcyIsIl9lcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsIl9mb3JtIiwiX3Nob3dJbnB1dEVycm9yIiwiaW5wdXRFbCIsImVycm9yTWVzc2FnZUVsZW1lbnQiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsIl9oaWRlSW5wdXRFcnJvciIsIl9jaGVja0lucHV0VmFsaWRpdHkiLCJ2YWxpZGl0eSIsInZhbGlkIiwiX2hhc0ludmFsaWRJbnB1dCIsImlucHV0TGlzdCIsImV2ZXJ5IiwiZGlzYWJsZUJ1dHRvbiIsIl9zdWJtaXRCdXR0b24iLCJkaXNhYmxlZCIsIl9lbmFibGVCdXR0b24iLCJfdG9nZ2xlQnV0dG9uU3RhdGUiLCJfaW5wdXRFbHMiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsImVuYWJsZVZhbGlkYXRpb24iLCJldnQiLCJwcmV2ZW50RGVmYXVsdCIsInJlc2V0VmFsaWRhdGlvbiIsIlNlY3Rpb24iLCJjbGFzc1NlbGVjdG9yIiwiaXRlbXMiLCJyZW5kZXJlciIsIl9pdGVtcyIsIl9yZW5kZXJlciIsIl9jb250YWluZXIiLCJyZW5kZXJJdGVtcyIsIml0ZW0iLCJhZGRJdGVtIiwicHJlcGVuZCIsIlBvcHVwIiwicG9wdXBTZWxlY3RvciIsIl9wb3B1cEVsZW1lbnQiLCJfaGFuZGxlRXNjQ2xvc2UiLCJiaW5kIiwib3BlbiIsImNsb3NlIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImtleSIsInNldEV2ZW50TGlzdGVuZXJzIiwiX3BvcHVwQ2xvc2VCdG4iLCJ0YXJnZXQiLCJjdXJyZW50VGFyZ2V0IiwiUG9wdXBXaXRoRm9ybSIsImhhbmRsZUZvcm1TdWJtaXQiLCJzdXBlciIsIl9wb3B1cEZvcm0iLCJfaGFuZGxlRm9ybVN1Ym1pdCIsInZpZXdMb2FkaW5nIiwiaXNMb2FkaW5nIiwiX2dldElucHV0VmFsdWVzIiwiX2lucHV0RWxlbWVudHMiLCJBcnJheSIsImZyb20iLCJpbnB1dFZhbHVlcyIsImlucHV0IiwidmFsdWUiLCJyZXNldEZvcm0iLCJyZXNldCIsImZvcm1TZWxlY3RvciIsInByb2ZpbGVFZGl0Rm9ybSIsImZvcm1zIiwiYWRkQ2FyZEZvcm1FbGVtZW50IiwiZWRpdEF2YXRhckZvcm0iLCJwcm9maWxlRWRpdEJ1dHRvbiIsImFkZE5ld0NhcmRCdXR0b24iLCJwcm9maWxlQXZhdGFyQnV0dG9uIiwicHJldmlld1BvcHVwIiwicHJvZmlsZVRpdGxlSW5wdXQiLCJwcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImZpcnN0RWxlbWVudENoaWxkIiwiYXBpIiwiYmFzZVVybCIsImhlYWRlcnMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiZ2V0VXNlckluZm9BbmRDYXJkcyIsIlByb21pc2UiLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VyIiwiX2NoZWNrUmVzcG9uc2UiLCJyZXMiLCJvayIsImpzb24iLCJyZWplY3QiLCJzdGF0dXMiLCJmZXRjaCIsInRoZW4iLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImFkZENhcmQiLCJfcmVmMiIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiZWRpdFByb2ZpbGUiLCJhYm91dCIsInJlbW92ZUNhcmQiLCJjYXJkSWQiLCJhZGRMaWtlIiwicmVtb3ZlTGlrZSIsInVwZGF0ZUF2YXRhciIsImF2YXRhciIsImF1dGhvcml6YXRpb24iLCJ1c2VySW5mbyIsIl9hYm91dCIsIl9hdmF0YXIiLCJnZXRVc2VySW5mbyIsInNldFVzZXJJbmZvIiwic2V0QXZhdGFyIiwiY2FyZFNlY3Rpb24iLCJjYXJkRGF0YSIsInBvcHVwSW1hZ2UiLCJnZXRDYXJkRWxlbWVudCIsImNhcmRFbGVtZW50IiwibmV3Q2FyZFBvcHVwIiwiZGF0YSIsInByb2ZpbGVFZGl0UG9wdXAiLCJwcm9maWxlRWRpdFZhbGlkYXRvciIsImFkZENhcmRWYWxpZGF0b3IiLCJhZGRBdmF0YXJWYWxpZGF0b3IiLCJfcHJldmlld0ltYWdlRWxlbWVudCIsIl9wcmV2aWV3SW1hZ2VFbGVtZW50VGl0bGUiLCJzZXRBdHRyaWJ1dGUiLCJmaW5hbGx5IiwiYXZhdGFyRWRpdFBvcHVwIiwiY2FyZCIsImRlbGV0ZUNhcmRQb3B1cCIsInNldENvbmZpcm1EZWxldGUiXSwic291cmNlUm9vdCI6IiJ9